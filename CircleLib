local WindowsCircle = {}
WindowsCircle.__index = WindowsCircle

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

function WindowsCircle.new(windowName)
    local self = setmetatable({}, WindowsCircle)
    
    self.Areas = {}
    self.CurrentPageIndex = 1
    self.CurrentRotation = 0
    self.IsOpen = false
    self.Toggles = {}

    -- Criando a ScreenGui principal
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "CircleLib_" .. windowName
    self.ScreenGui.ResetOnSpawn = false -- Importante para não sumir ao morrer
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Tenta colocar no PlayerGui
    local pgui = player:FindFirstChild("PlayerGui")
    if pgui then
        self.ScreenGui.Parent = pgui
    else
        -- Fallback caso o carregamento seja rápido demais
        task.spawn(function()
            self.ScreenGui.Parent = player:WaitForChild("PlayerGui")
        end)
    end

    -- Botão de Abrir/Fechar (O ☺ que você pediu)
    self.OpenButton = Instance.new("TextButton")
    self.OpenButton.Name = "OpenBtn"
    self.OpenButton.Size = UDim2.fromOffset(50, 50)
    self.OpenButton.Position = UDim2.new(0, 20, 0.5, -25)
    self.OpenButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    self.OpenButton.BackgroundTransparency = 0.3
    self.OpenButton.Text = "☺"
    self.OpenButton.TextColor3 = Color3.new(1, 1, 1)
    self.OpenButton.TextSize = 30
    self.OpenButton.Parent = self.ScreenGui
    
    Instance.new("UICorner", self.OpenButton).CornerRadius = UDim.new(1, 0)
    local stroke = Instance.new("UIStroke", self.OpenButton)
    stroke.Color = Color3.new(1, 1, 1)
    stroke.Thickness = 2

    -- Frame do Menu (O seu design original)
    self.MainFrame = Instance.new("Frame")
    self.MainFrame.Name = "MainFrame"
    self.MainFrame.Visible = false
    self.MainFrame.Size = UDim2.fromOffset(268, 268) -- Radius * 2
    self.MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    self.MainFrame.Position = UDim2.fromScale(0.5, 0.5)
    self.MainFrame.BackgroundTransparency = 1
    self.MainFrame.Parent = self.ScreenGui

    self.Group = Instance.new("CanvasGroup")
    self.Group.Size = UDim2.fromScale(1, 1)
    self.Group.BackgroundTransparency = 1
    self.Group.Parent = self.MainFrame

    -- Rotação e Centro (Mesma lógica do seu código original)
    self.RotationWrapper = Instance.new("Frame")
    self.RotationWrapper.Size = UDim2.fromScale(1, 1)
    self.RotationWrapper.BackgroundTransparency = 1
    self.RotationWrapper.Parent = self.Group

    self.CenterCircle = Instance.new("TextButton")
    -- ... (Restante das propriedades de design que você já tem)
    
    -- Funções Internas
    self.OpenButton.MouseButton1Click:Connect(function()
        self:ToggleMenu()
    end)

    print("CircleLib: Gui '" .. windowName .. "' carregada com sucesso!")
    return self
end

-- (Mantenha as funções AddArea, AddButton, AddToggle e ToggleMenu aqui)

-- ESSENCIAL: Definir a global e retornar a tabela
_G.Windows = { circle = { luay = WindowsCircle.new } }
return WindowsCircle
